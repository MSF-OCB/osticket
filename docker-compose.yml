version: '3.5'
services:

# for dev docker-compose up -d osticket
# then on port 80

  osticket:
    container_name: osticket
    restart: always
    env_file: 
      - .osticket.env
      - .db.env
    #image: campbellsoftwaresolutions/osticket
    image: msfocb/osticket:1.14.1_awesome
    labels:
      - "org.msf.description=osticket"
      - "traefik.backend=osticket"
      - "traefik.frontend.rule=Host:helpdesk.sherlog.ocb.msf.org"
      - "traefik.enable=true"
      - "traefik.port=80"
    networks:
      - web
      - default
    depends_on:
      - mysql
    volumes:
      - type: volume
        source: osticket-dbvolume
        target: /var/lib/mysql

  mysql:
    container_name: osticket_db
    restart: always
    env_file: .db.env
    image: mysql:5
    volumes:
      - type: volume
        source: osticket-dbvolume
        target: /var/lib/mysql

  backup:
    image: msfocbehealth/backup:latest
    labels:
      - "org.msf.description=backup"
    restart: always
    env_file: .bnc.env
    volumes:
      - type: volume
        source: osticket-backups
        target: /backups
    depends_on:
      - mysql
      
volumes:
    osticket-dbvolume:
        name: osticket-dbvolume
    osticket-backups:
        name: osticket_backups

networks:
  web:
    external: true
